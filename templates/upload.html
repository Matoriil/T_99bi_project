<!DOCTYPE html>
<html lang="en">
<head>
    <title>99BI-数据上传</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <!-- Bootstrap Core CSS -->
    <link href="../static/css/bootstrap.min.css" rel='stylesheet' type='text/css'/>
    <!-- Custom CSS -->
    <link href="../static/css/style4.css" rel='stylesheet' type='text/css'/>
    <link rel="stylesheet" href="../static/css/morris.css" type="text/css"/>
    <!-- Graph CSS -->
    <link href="../static/css/font-awesome.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="../static/js/jquery-2.1.4.min.js"></script>
    <!-- //jQuery -->
    <link href='//fonts.googleapis.com/css?family=Roboto:700,500,300,100italic,100,400' rel='stylesheet'
          type='text/css'/>
    <link href='//fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <!-- lined-icons -->
    <link rel="stylesheet" href="../static/css/icon-font.min.css" type='text/css'/>
    <!-- //lined-icons -->
    <script type="text/javascript" src="http://www.daixiaorui.com/Public/js/jquery.min.js"></script>
    <!-- js -->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="../static/js/Visual.js"></script>
    <link rel="stylesheet" type="text/css" href="../static/css/Visual.css">
    <script type="text/javascript" src="js/jquery-1.11.0.js" ></script>
    {#    #echarts#}
    <script type="text/javascript" src="{{ url_for('static',filename='js/echarts.js') }}"></script>
    <style>
			*{
				margin: 0;
			}
			.progress{
				width: 200px;
				height: 20px;
				background: #ddd;
				position: relative;
			}
			.info{
				width:0px;
				height: 20px;
				background: #ec5710;
				position: absolute;
				left: 0;
				top: 0;
			}

		</style>

</head>
<body onload="loads();">
<form id="form1" onsubmit="return subit_onclick()" method="post" action="/upload" enctype="multipart/form-data">
 <input style="display:none" name="show_data_value" id="show_data_value" value="">
    <div class="page-container">
        <!--左边布局-->
        <div class="left-content">
            <!--网页布局-->
            <!--文件上传-->
            <div class="mother-grid-inner" id="mother-grid-inner" style="display: block">

                <div style="display:none" id="grid-form-dx_BS1" class="grid-form1">
                    <div class="grid-form1">
                        <label for="exampleInputEmail2">文件上传操作</label>
                        <div id="data_input" style="display: block">
                            <div class="filePicker btn btn-default">
                                <input id="file" type="file" name="myfile">
                                <label for="file">上传文件</label>
                            </div>
                            <input  style="display:inline-block;width:350px" name="xlsx_sheet" id="xlsx_sheet" value=""  placeholder="xlsx文件请输入xlsx工作溥名,不填默认为Sheet1">
                            <div id="image_gif" style="width: 50px;height: 50px;display: none">
                                <div style="display: inline-block">
                                    <img style="width: 50px;height: 50px;display: inline-block"  src="../static/image/等待.gif" >
                                </div>
                                <div style="width: 200px;height: 50px;display: inline-block;color: #1c93c4">
                                    上传文件转码中
                                </div>
                            </div>

                        </div>


                    {% with messages = get_flashed_messages() %}
                      {% if messages %}
                        <ul class=flashes>
                        {% for message in messages %}
                          <li style="color:red;font-size:20px;">{{ message }}</li>
                        {% endfor %}
                        </ul>
                      {% endif %}
                    {% endwith %}
                </div>
            </div>

            <div style="height: 10px;"></div>
            <!--数据库连接-->
            <div style="display:none" id="child1" class="grid-form1">
                <div class="grid-form1">
                    <label for="exampleInputEmail2">PostgreSQL对接</label>
                    <h3>
                    <div id="1" style="text-align:center">
                            <div style="display: inline-block" >账号:&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</div>
                            <input style="display: inline-block" id="data1" name="data1" value=""></div>
                    <div style="height: 20px;"></div>
                    <div id="2" style="text-align:center">
                            <div style="display: inline-block">密码:&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</div>
                            <input style="display: inline-block" id="data2" name="data2" value=""></div>
                    <div style="height: 20px;"></div>
                    <div id="3" style="text-align:center">
                            <div style="display: inline-block">IP地址:&nbsp&nbsp&nbsp</div>
                        <input style="display: inline-block" id="data3" name="data3" value=""></div>
                    <div style="height: 20px;"></div>
                    <div id="4" style="text-align:center">
                            <div style="display: inline-block">端口:&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</div>
                            <input style="display: inline-block" id="data4" name="data4" value=""></div>
                    <div style="height: 20px;"></div>
                    <div id="5" style="text-align:center">
                            <div style="display: inline-block">数据库名:</div>
                            <input style="display: inline-block" id="data5" name="data5" value=""></div>
                    <div style="height: 20px;"></div>
                    <div id="6" style="text-align:center">
                            <div style="display: inline-block">数据表名:</div>
                            <input style="display: inline-block" id="data6" name="data6" value=""></div>
                        </h3>
                </div>
            </div>
            <!--左侧操作栏-->
            <div class="sidebar-menu" ondrop="deletes(event)" ondragover="allowDrop(event)">
                <div style="border-top:5px ridge rgba(255, 255, 255, 0.15)"></div>
                <ul id="menu">
                     <li>
                     <div onclick="pso_def()">
                     <a>PostgreSQL数据对接<span
                     class="fa fa-angle-right" style="float: right"></span></a></div>
                     </li>

                    <li>
                     <div onclick="csv_but()">
                     <a>csv上传<span
                     class="fa fa-angle-right" style="float: right"></span></a></div>
                     </li>
                    <li>
                     <div onclick="xlxs_but()">
                     <a>xlsx上传<span
                     class="fa fa-angle-right" style="float: right"></span></a></div>
                     </li>
                </ul>
            </div>
            <div id="buts_two" style="display: none">
            <input type="submit" class="btn btn-default" id="btn" ></input>
            {% if file_size !=0 %}
            <input type="button" class="btn btn-default" value="上传完毕" onclick="javascrtpt:window.location.href='handle'"/>
            {% endif %}
            {% if file_size== 0 %}
                <div>并未上传任何数据源</div>
            {% endif %}
            </div>
            <!--网页布局结束-->
        </div>
        <!--左边布局结束-->
    </div>
    <!--整体布局结束-->
    </div>
</form>
</body>
</html>
		<script>
            function loads() {
                {% if ns_f=='ns=1' %}
                csv_but();
                {% elif ns_f=='xs=1' %}
                xlxs_but();
                {% endif %}
            }

            function pso_def() {
                document.getElementById('child1').style.display = 'block';
                document.getElementById('buts_two').style.display = 'none';
                    document.getElementById('grid-form-dx_BS1').style.display = 'none';
                    document.getElementById('xlsx_sheet').style.display = 'none';
            }


            function csv_but() {
                    document.getElementById('child1').style.display = 'none';
                    document.getElementById('buts_two').style.display = 'block';
                    document.getElementById('grid-form-dx_BS1').style.display = 'block';
                    document.getElementById('xlsx_sheet').style.display = 'none';
                    xs=0;
                    ns=1;
                    document.getElementById('show_data_value').value = 'ns='+ns;

            }


            function xlxs_but() {
                    document.getElementById('child1').style.display = 'none';
                    document.getElementById('buts_two').style.display = 'block';
                    document.getElementById('grid-form-dx_BS1').style.display = 'block';
                    document.getElementById('xlsx_sheet').style.display = 'block';
                    ns=0
                    xs=1;
                    document.getElementById('show_data_value').value = 'xs='+xs;

            }







            function subit_onclick() {
                 document.getElementById('image_gif').style.display = 'inline-block';
                 return true;
            }










			var oFlie = document.getElementById("file")
			var oBtn = document.getElementById("btn")
			var oRes = document.getElementById("result")
			var oImg = document.getElementsByTagName("img")
			var oInfo = document.getElementById("info")
			oBtn.onclick = function(){

				var fs = oFlie.files[0]
				var reader = new FileReader(fs)


				reader.onprogress = function(e){

					oInfo.style.width= e.loaded/e.total*200+"px"
					oRes.innerHTML = Math.round((e.loaded/e.total*200)*0.5)+"%"
				}

				reader.onload = function(){

					var data = new FormData()
					data.append("file",fs)


					$.ajax({
						type:"post",
						url:"api/test.php",
						async:true,
						data:{
							data:data
						},
						processData:false,
						contentType:false,
						success:function(res){
							console.log(res)
						}
					});


				}


				reader.readAsDataURL(fs)

			}

		</script>